<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒÚ¯Ø± Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø¹ÙˆÙ†Ø§ Ø®Ø§Ù†Ù…â€ŒÙ‡Ø§</title>
  <script src="https://unpkg.com/jalaali-js@1.1.0/dist/jalaali.min.js"></script>
  <script src="https://unpkg.com/hebcal"></script>
  <style>
    body {
      background-color: #d0ecff;
      font-family: 'B Nazanin', sans-serif;
      font-size: 16px;
      direction: rtl;
      padding: 20px;
    }
    select, label {
      margin: 5px;
    }
    .date-block, .output {
      margin-bottom: 20px;
      background: white;
      padding: 15px;
      border-radius: 10px;
    }
    .output {
      border: 1px solid #aaa;
    }
  </style>
</head>
<body>

<h2>ğŸ”µ Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒÚ¯Ø± Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø¹ÙˆÙ†Ø§ Ø®Ø§Ù†Ù…â€ŒÙ‡Ø§</h2>

<div class="date-block">
  <label>ØªØ§Ø±ÛŒØ® Ù‚Ø§Ø¹Ø¯Ú¯ÛŒ Ø§Ø®ÛŒØ±:</label><br>
  <select id="recentYear"></select> /
  <select id="recentMonth"></select> /
  <select id="recentDay"></select>
  <div id="recentHebrew"></div>
</div>

<div class="date-block">
  <label>ØªØ§Ø±ÛŒØ® Ù‚Ø§Ø¹Ø¯Ú¯ÛŒ Ù‚Ø¨Ù„ÛŒ:</label><br>
  <select id="prevYear"></select> /
  <select id="prevMonth"></select> /
  <select id="prevDay"></select>
  <div id="prevHebrew"></div>
</div>

<button onclick="calculate()">ğŸ“… Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø¹ÙˆÙ†Ø§</button>

<div class="output" id="results"></div>

<script>
function fillSelect(id, start, end) {
  const sel = document.getElementById(id);
  for (let i = start; i <= end; i++) {
    const opt = document.createElement("option");
    opt.value = i;
    opt.innerText = i.toString().padStart(2, '0');
    sel.appendChild(opt);
  }
}

["recent", "prev"].forEach(prefix => {
  fillSelect(prefix + "Year", 1390, 1410);
  fillSelect(prefix + "Month", 1, 12);
  fillSelect(prefix + "Day", 1, 31);

  ["Year", "Month", "Day"].forEach(part => {
    document.getElementById(prefix + part).addEventListener("change", () => updateHebrew(prefix));
  });
});

function jalaliToGregorian(y, m, d) {
  const g = jalaali.toGregorian(y, m, d);
  return new Date(g.gy, g.gm - 1, g.gd);
}

function toJalaliStr(date) {
  const j = jalaali.toJalaali(date);
  const weekdays = ["ÛŒÚ©Ø´Ù†Ø¨Ù‡", "Ø¯ÙˆØ´Ù†Ø¨Ù‡", "Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡", "Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡", "Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡", "Ø¬Ù…Ø¹Ù‡", "Ø´Ù†Ø¨Ù‡"];
  const weekday = weekdays[date.getDay()];
  return `${j.jy}/${j.jm.toString().padStart(2,'0')}/${j.jd.toString().padStart(2,'0')} - ${weekday}`;
}

function updateHebrew(idPrefix) {
  const y = +document.getElementById(idPrefix + "Year").value;
  const m = +document.getElementById(idPrefix + "Month").value;
  const d = +document.getElementById(idPrefix + "Day").value;
  if (y && m && d) {
    const gDate = jalaliToGregorian(y, m, d);
    const hebDate = new Hebcal.HDate(gDate);
    document.getElementById(idPrefix + "Hebrew").innerText =
      "ğŸ“† ØªØ§Ø±ÛŒØ® Ø¹Ø¨Ø±ÛŒ: " + hebDate.renderHebrewDate();
  }
}

function calculate() {
  const y1 = +document.getElementById("recentYear").value;
  const m1 = +document.getElementById("recentMonth").value;
  const d1 = +document.getElementById("recentDay").value;
  const y2 = +document.getElementById("prevYear").value;
  const m2 = +document.getElementById("prevMonth").value;
  const d2 = +document.getElementById("prevDay").value;

  if (!(y1 && m1 && d1 && y2 && m2 && d2)) {
    alert("Ù„Ø·ÙØ§Ù‹ Ù‡Ø± Ø¯Ùˆ ØªØ§Ø±ÛŒØ® Ø±Ø§ Ú©Ø§Ù…Ù„ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.");
    return;
  }

  const recentDate = jalaliToGregorian(y1, m1, d1);
  const prevDate = jalaliToGregorian(y2, m2, d2);
  const dayDiff = Math.round((recentDate - prevDate) / (1000 * 60 * 60 * 24));

  const result1 = new Date(recentDate); result1.setDate(result1.getDate() + 30);
  const result2 = new Date(recentDate); result2.setDate(result2.getDate() + dayDiff);

  const hebRecent = new Hebcal.HDate(recentDate);
  const nextHebMonth = hebRecent.getMonth() + 1;
  const nextHebYear = hebRecent.getMonth() === 12 ? hebRecent.getFullYear() + 1 : hebRecent.getFullYear();
  const sameDayNextMonthHeb = new Hebcal.HDate(hebRecent.getDate(), nextHebMonth, nextHebYear);
  const result3G = sameDayNextMonthHeb.greg();

  const out = `
    âœ… Û³Û° Ø±ÙˆØ² Ø¨Ø¹Ø¯: ${toJalaliStr(result1)} <br> ğŸ• ${new Hebcal.HDate(result1).renderHebrewDate()}<br><br>
    âœ… ${dayDiff} Ø±ÙˆØ² Ø¨Ø¹Ø¯ Ø§Ø² ØªØ§Ø±ÛŒØ® Ø§Ø®ÛŒØ±: ${toJalaliStr(result2)} <br> ğŸ• ${new Hebcal.HDate(result2).renderHebrewDate()}<br><br>
    âœ… Ù‡Ù…Ø§Ù† Ø±ÙˆØ² Ø¯Ø± Ù…Ø§Ù‡ Ø¨Ø¹Ø¯ Ø¹Ø¨Ø±ÛŒ: ${toJalaliStr(result3G)} <br> ğŸ• ${sameDayNextMonthHeb.renderHebrewDate()}
  `;

  document.getElementById("results").innerHTML = "<h3>ğŸ”» Ù†ØªØ§ÛŒØ¬:</h3>" + out;
}

</script>

</body>
</html>
